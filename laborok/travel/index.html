
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Ekler Péter, Gazdi László, Kövesdán Gábor, Pásztor Dániel, Pomázi Krisztián">
      
      
      
        <link rel="prev" href="../news/">
      
      
        <link rel="next" href="../../hf/">
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.14">
    
    
      
        <title>Labor 3 - Travel - BMEVIAUBXAV080 - Haladó Android fejlesztés laborfeladatok</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#labor-3-travel" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../.." title="BMEVIAUBXAV080 - Haladó Android fejlesztés laborfeladatok" class="md-header__button md-logo" aria-label="BMEVIAUBXAV080 - Haladó Android fejlesztés laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUBXAV080 - Haladó Android fejlesztés laborfeladatok
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Labor 3 - Travel
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Váltás sötét témára"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent=""  aria-label="Váltás világos témára"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Keresés">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/viaubxav080/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viaubxav080/laborok
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Lapok" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Tudnivalók
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../snake/" class="md-tabs__link md-tabs__link--active">
        Laborok
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hf/" class="md-tabs__link">
        Házi feladat
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUBXAV080 - Haladó Android fejlesztés laborfeladatok" class="md-nav__button md-logo" aria-label="BMEVIAUBXAV080 - Haladó Android fejlesztés laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUBXAV080 - Haladó Android fejlesztés laborfeladatok
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/viaubxav080/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viaubxav080/laborok
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Tudnivalók
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Tudnivalók
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Tárgy ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub/" class="md-nav__link">
        Feladatok beadása (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub-Actions/" class="md-nav__link">
        GitHub Actions ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub-credentials/" class="md-nav__link">
        Egyetemi laborokban: GitHub belépés
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/contributing/" class="md-nav__link">
        Hozzájárulás az anyaghoz
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Laborok
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Laborok
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../snake/" class="md-nav__link">
        Labor 1 - Snake Game
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../news/" class="md-nav__link">
        Labor 2 - News
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Labor 3 - Travel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Labor 3 - Travel
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#projekt-megnyitasa" class="md-nav__link">
    Projekt megnyitása
  </a>
  
    <nav class="md-nav" aria-label="Projekt megnyitása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elso-feladat-az-alkalmazas-attekintese-a-backend-inditasa-jaratok-listazasa" class="md-nav__link">
    Első feladat: az alkalmazás áttekintése, a backend indítása, járatok listázása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#masodik-feladat-foglalas-mqtt-segitsegevel" class="md-nav__link">
    Második feladat: Foglalás MQTT segítségével
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#harmadik-feladat-hibakezeles" class="md-nav__link">
    Harmadik feladat: Hibakezelés
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#negyedik-feladat-orszaginfok-lekerdezese" class="md-nav__link">
    Negyedik feladat: Országinfók lekérdezése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#otodik-feladat-authentikacio" class="md-nav__link">
    Ötödik feladat: Authentikáció
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hatodik-feladat-token-biztonsagos-tarolasa" class="md-nav__link">
    Hatodik feladat: Token biztonságos tárolása
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Házi feladat
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Házi feladat
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hf/" class="md-nav__link">
        Házi feladat információk
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#projekt-megnyitasa" class="md-nav__link">
    Projekt megnyitása
  </a>
  
    <nav class="md-nav" aria-label="Projekt megnyitása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elso-feladat-az-alkalmazas-attekintese-a-backend-inditasa-jaratok-listazasa" class="md-nav__link">
    Első feladat: az alkalmazás áttekintése, a backend indítása, járatok listázása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#masodik-feladat-foglalas-mqtt-segitsegevel" class="md-nav__link">
    Második feladat: Foglalás MQTT segítségével
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#harmadik-feladat-hibakezeles" class="md-nav__link">
    Harmadik feladat: Hibakezelés
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#negyedik-feladat-orszaginfok-lekerdezese" class="md-nav__link">
    Negyedik feladat: Országinfók lekérdezése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#otodik-feladat-authentikacio" class="md-nav__link">
    Ötödik feladat: Authentikáció
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hatodik-feladat-token-biztonsagos-tarolasa" class="md-nav__link">
    Hatodik feladat: Token biztonságos tárolása
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="labor-3-travel">Labor 3 - Travel<a class="headerlink" href="#labor-3-travel" title="Permanent link">&para;</a></h1>
<p>A harmadik laborban egy utazási iroda applikációját fejlesztjük ki, amelyet az utazási iroda munkatársai használnak.
Az utazási iroda az ügyfeleinek több dolgot elvégez, és ehhez változatos technológiák használatára van szükség.
Az alkalmazás funkciói az alábbiak lesznek:</p>
<ul>
<li>Listázza az elérhető járatokat, amelyekre jelenleg lehet foglalni. A járatok listáját egy WebSocket API-n keresztül
éri el. Itt történik az indulás utáni első lekédezés, és a futás közben megjelent új ajánlatok letöltése is.</li>
<li>Amikor foglalni szükséges, a foglalást az iroda egy aszinkron üzenetsorba küldi MQTT protokollon keresztül.</li>
<li>Előfordul, hogy az irodát felhívják az ügyfelek, és információkat kérnek az egyes úticélokról. Ehhez az iroda egy
publikus GraphQL API-n keresztül kérdez le információkat az adott országról.</li>
<li>Bizonyos későbbi funkciókhoz az iroda munkatársainak be kell jelentkezniük az alkalmazásba. Ezt egy hagyományos REST 
hívással lehet elvégezni, amely egy hozzáférési tokent ad vissza. Szeretnénk ezt viszont az alkalmazásban a best
practice-ek szerint biztonságosan tárolni.</li>
</ul>
<p>A feladat során az alábbi technológiákkal fogunk találkozni:</p>
<ul>
<li>Modern App Architecture</li>
<li>WebSocket</li>
<li>MQTT</li>
<li>GraphQL</li>
<li>Biometrikus azonosítás</li>
</ul>
<p>Az alkalmazásban mindössze négy lényeges felület lesz. Kezdetben egy login képernyő fogad, amely a projektvázban bármilyen
felhasználónév-jelszó párosra beenged. A főképernyőn a járatok láthatóak. A menüből navigálhatunk a
másik két képernyőre. Az egyiken foglalást lehet végezni, a másikon az országok adatai böngészhetők. Az utóbbit kivéve
a képernyők már elő vannak készítve a projektvázban:</p>
<p align="center">
<a class="glightbox" href="./assets/travel_login.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/travel_login.png" width="320"></a>
<a class="glightbox" href="./assets/travel_home.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/travel_home.png" width="320"></a>
<a class="glightbox" href="./assets/travel_booking.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="./assets/travel_booking.png" width="320"></a>
</p>

<div class="admonition info">
<p class="admonition-title">Pontozás</p>
<p>Ebben a laborban két "vezetett" (= teljesen dokumentált) és négy önálló feladat is van. A négy önálló feladatból csak az
utolsó épül az előtte levőre, a többiből tetszőleges összeállításban megszerezheted a maximális 3 pontot.</p>
</div>
<h2 id="elokeszuletek">Előkészületek<a class="headerlink" href="#elokeszuletek" title="Permanent link">&para;</a></h2>
<p>A feladatok megoldása során ne felejtsd el követni a <a href="../../tudnivalok/github/GitHub">feladat beadása folyamatát</a>.</p>
<h3 id="git-repository-letrehozasa-es-letoltese">Git repository létrehozása és letöltése<a class="headerlink" href="#git-repository-letrehozasa-es-letoltese" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Moodle-ben keresd meg a laborhoz tartozó meghívó URL-jét és annak segítségével hozd létre a saját repository-dat.</p>
</li>
<li>
<p>Várd meg, míg elkészül a repository, majd checkout-old ki.</p>
<div class="admonition tip">
<p>Egyetemi laborokban, ha a checkout során nem kér a rendszer felhasználónevet és jelszót, és nem sikerül a checkout, akkor valószínűleg a gépen korábban megjegyzett felhasználónévvel próbálkozott a rendszer. Először töröld ki a mentett belépési adatokat (lásd <a href="../../tudnivalok/github/GitHub-credentials/">itt</a>), és próbáld újra.</p>
</div>
</li>
<li>
<p>Hozz létre egy új ágat <code>megoldas</code> néven, és ezen az ágon dolgozz.</p>
</li>
<li>
<p>A <code>neptun.txt</code> fájlba írd bele a Neptun kódodat. A fájlban semmi más ne szerepeljen, csak egyetlen sorban a Neptun kód 6 karaktere.</p>
</li>
</ol>
<h2 id="projekt-megnyitasa">Projekt megnyitása<a class="headerlink" href="#projekt-megnyitasa" title="Permanent link">&para;</a></h2>
<p>Az alkalmazás váza már adott a <code>Travel</code> könyvtárban. Nyissuk meg a könyvtárat az Android Studióval.</p>
<h3 id="elso-feladat-az-alkalmazas-attekintese-a-backend-inditasa-jaratok-listazasa">Első feladat: az alkalmazás áttekintése, a backend indítása, járatok listázása<a class="headerlink" href="#elso-feladat-az-alkalmazas-attekintese-a-backend-inditasa-jaratok-listazasa" title="Permanent link">&para;</a></h3>
<p>Tekintsük át az alkalmazás kódját! Az alkalmazás a Modern App Architecture elvek szerint készült, de még fix listát ad
vissza a járatokról. Ezt fogjuk majd módosítani olyan módon, hogy egy WebSocket csatornára kapcsolódunk, ahol kapcsolódás
után megkapjuk az eddigi járatok listáját, illetve a kapcsolódástól kezdve mindig frissítést kapunk, ha új járatot
írtak ki.</p>
<p>A backend a feladat repository-jában, a <code>travel-backend</code> könyvtárban található, és többféleképpen indítható. Ha Docker
nélkül indítjuk, akkor JDK 17 vagy újabb szükséges hozzá. A backend egy gradle projekt, és gradle wrappert is tartalmaz,
így a könyvtárban parancssorral könnyen indítható.</p>
<p>Windowson:</p>
<p><code>.\gradlew.bat bootRun</code></p>
<p>Linuxon és Macen:</p>
<p><code>./gradlew bootRun</code></p>
<p>Vagy ha ismerős számunkra a Docker, akkor a projekt gyökerében elhelyezett <code>Dockerfile</code> segítségével készíthetünk egy
image-et, amit futtatva elindul a backend. Ha így indítod, ügyelj rá, hogy a 8080-as belső portot mappeld a hosztgép
8080-as portjára!</p>
<p>Végezetül egy harmadik lehetőség, hogy ha ismerős számunkra a Java (Kotlin) alapú backendfejlesztés, akkor a projektet
egy fejlesztőkörnyezetben (IntelliJ, Eclipse, VS Code) megnyitva is futtathatjuk a projektet.</p>
<p>Az új ajánlatok érkezését (és ezáltal a WebSocketen új üzenet küldését) a backend egy adott végpontjával válthatjuk ki.
A <code>http://localhost:8080/api/offers</code> végpontra szükséges egy POST üzenetet küldenünk JSON formátumban, pl. az alábbi
tartalommal:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;flightNumber&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WIZZ987&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BUD&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LIS&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;departure&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-10T08:30&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;durationMinutes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">170</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;priceEur&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span>
<span class="p">}</span>
</code></pre></div>
<p>Ez a felküldés nem része az Androidos alkalmazás funkcióinak, de ezt elvégezheted az előző laboron megismert <code>Swagger UI</code>
felülettel, amely az OpenAPI leírással együtt most is generálódik. Vagy ha ismered, használhatod a Postman alkalmazást is.
Egy új járat felvétele után a backend konzoljában tudod ellenőrizni, hogy beérkezett a backendhez az ajánlat.</p>
<p>A megoldáshoz a <code>kotlinx-serialization</code> technológiát is használni fogjuk, ez kódgeneráláson alapul, ezért egy Gradle
plugin is szükséges hozzá. Ezért először a projektszintű <code>build.gradle.kts</code> fájlba vegyük fel a szükséges plugint:</p>
<div class="highlight"><pre><span></span><code><span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.kotlin.plugin.serialization&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;2.0.20&quot;</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="kc">false</span>
</code></pre></div>
<p>Majd alkalmazzuk a modulszintű <code>build.gradle.kts</code> fájlunkban:</p>
<div class="highlight"><pre><span></span><code><span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.kotlin.plugin.serialization&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>És vegyük fel a szükséges függőségeket is, majd szinkronizáljuk a projektet:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// WebSocket</span>
<span class="n">implementation</span><span class="p">(</span><span class="s">&quot;io.ktor:ktor-client-okhttp:2.3.11&quot;</span><span class="p">)</span>
<span class="n">implementation</span><span class="p">(</span><span class="s">&quot;io.ktor:ktor-client-websockets:2.3.11&quot;</span><span class="p">)</span>
<span class="n">implementation</span><span class="p">(</span><span class="s">&quot;io.ktor:ktor-client-content-negotiation:2.3.11&quot;</span><span class="p">)</span>
<span class="n">implementation</span><span class="p">(</span><span class="s">&quot;io.ktor:ktor-client-core:2.3.11&quot;</span><span class="p">)</span>
<span class="n">implementation</span><span class="p">(</span><span class="s">&quot;io.ktor:ktor-serialization-kotlinx-json:2.3.11&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Az alkalmazásunknak az <code>INTERNET</code> engedélyre van szüksége, illetve engedélyeznie kell, hogy SSL nélküli hálózati
kapcsolatot használjunk. Ezek a beállítások a Manifestben már el vannak végezve.</p>
<p>Készítsünk a <code>datasource</code> package-en belül egy <code>util</code> package-et, és oda vegyük fel az alábbi segédosztályt:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.travel.data.datasource.util;</span>

<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.HttpClient</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.engine.okhttp.OkHttp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.plugins.contentnegotiation.ContentNegotiation</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.plugins.websocket.WebSockets</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.serialization.kotlinx.KotlinxWebsocketSerializationConverter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.serialization.kotlinx.json.json</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.serialization.json.Json</span>

<span class="kd">object</span><span class="w"> </span><span class="nc">KtorClient</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">(</span><span class="n">OkHttp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">install</span><span class="p">(</span><span class="n">WebSockets</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">pingInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="n">_000</span>
<span class="w">            </span><span class="n">contentConverter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KotlinxWebsocketSerializationConverter</span><span class="p">(</span><span class="n">Json</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">install</span><span class="p">(</span><span class="n">ContentNegotiation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">json</span><span class="p">(</span>
<span class="w">                </span><span class="n">Json</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">prettyPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                    </span><span class="n">isLenient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Ezután a <code>FlightRepository</code> interfészünkhöz készítünk egy alternatív implementációt, amely a WebSocket kapcsolaton
keresztül fogadja az adatokat:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.travel.data.datasource</span>

<span class="k">import</span><span class="w"> </span><span class="nn">android.util.Log</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.travel.data.datasource.util.KtorClient</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.travel.data.entities.FlightEntity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.client.plugins.websocket.webSocketSession</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.http.URLProtocol</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.http.path</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.websocket.Frame</span>
<span class="k">import</span><span class="w"> </span><span class="nn">io.ktor.websocket.readText</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.Dispatchers</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.catch</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.map</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.receiveAsFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.withContext</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.serialization.json.Json</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">FlightRepositoryWebSocketImpl</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">FlightRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WEBSOCKET&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">state</span><span class="p">:</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">FlightEntity</span><span class="o">&gt;&gt;</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllFlights</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">FlightEntity</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">withContext</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KtorClient</span><span class="p">.</span><span class="na">httpClient</span><span class="p">.</span><span class="na">webSocketSession</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">url</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nb">it</span><span class="p">.</span><span class="na">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">URLProtocol</span><span class="p">.</span><span class="na">WS</span>
<span class="w">                </span><span class="nb">it</span><span class="p">.</span><span class="na">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;10.0.2.2&quot;</span>
<span class="w">                </span><span class="nb">it</span><span class="p">.</span><span class="na">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8080</span>
<span class="w">                </span><span class="nb">it</span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="s">&quot;/offers&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">socket</span>
<span class="w">            </span><span class="p">.</span><span class="na">incoming</span>
<span class="w">            </span><span class="p">.</span><span class="na">receiveAsFlow</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Frame</span><span class="p">.</span><span class="na">Text</span><span class="p">)</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">readText</span><span class="p">()</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">also</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Received data: </span><span class="si">$</span><span class="n">it</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Json</span><span class="p">.</span><span class="na">decodeFromString</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">FlightEntity</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span>
<span class="w">                </span><span class="n">data</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">.</span><span class="na">catch</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error: </span><span class="si">$</span><span class="n">error</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="n">error</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Most módosítsuk a dependency injection beállításait, hogy immár ezt az implementációt használjuk:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Module</span>
<span class="nd">@InstallIn</span><span class="p">(</span><span class="n">SingletonComponent</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">RepositoryModule</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Provides</span>
<span class="w">    </span><span class="nd">@Singleton</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideFlightRepository</span><span class="p">():</span><span class="w"> </span><span class="n">FlightRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlightRepositoryWebSocketImpl</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Modern App Architecture</p>
<p>Valójában a logikát egy DataSource komponensbe kellene szerveznünk a Modern App Architecture szerint, és a Repository
ennek a műveleteit ajánlaná ki aszinkron módon a felsőbb rétegeknek, de jelen esetben ez a szétválasztás kevés előnnyel
járna, ezért az egyszerűségre törekvés jegyében csak egy Repository komponensben valósítottuk meg a funkciókat.</p>
</div>
<p>Még egy lépés maradt hátra: a <code>FlightEntity</code> osztályon helyezzük el a <code>kotlinx-serialization</code> működéséhez szükséges
<code>@Serializable</code> annotációt:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">FlightEntity</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">flightNumber</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">from</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">to</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">departure</span><span class="p">:</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">durationMinutes</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">priceEur</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span>
<span class="p">)</span>
</code></pre></div>
<p>Most már futtathatjuk az alkalmazást, de előtte hozzunk létre 1-2 járatot, hogy megfigyeljük, hogy induláskor tényleg
betöltődik a kezdeti lista. A login képernyő egyelőre bármilyen adatokat elfogad, annak egy későbbi feladatrészben
lesz csak jelentősége. Vigyünk fel REST-hívással egy újabb járatot, amikor a főképernyő látható! Ennek most meg kell
jelennie a listában is.</p>
<p>Figyeld meg, hogyan alkalmazzuk a modern architektúrában a <code>Flow</code>-kat! A <code>BookingUseCase</code>-ben található <code>collect</code>
hívástól eltekintve a frissítések kezelése teljesen transzparens.</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts képernyőképet (f1.png) róla, hogy fut az alkalmazás, és benne megjelennek az általad felvitt járatok is.</p>
</div>
<h3 id="masodik-feladat-foglalas-mqtt-segitsegevel">Második feladat: Foglalás MQTT segítségével<a class="headerlink" href="#masodik-feladat-foglalas-mqtt-segitsegevel" title="Permanent link">&para;</a></h3>
<p>A második feladathoz szükségünk lesz egy MQTT protokollt támogató message brókerre. Ehhez itt a <code>Mosquitto</code> brókert
fogjuk használni. Ez legkönnyebben Docker segítségével indítható az alábbi módon.</p>
<p>Először egy konfigurációs fájlt kell létrehoznunk a számára egy tetszőleges könyvtárban, ennek a neve legyen
<code>mosquitto.conf</code>, tartalma:</p>
<div class="highlight"><pre><span></span><code>allow_anonymous true
listener 1883
protocol mqtt
</code></pre></div>
<p>Most állapítsunk meg, hogy mi a teljes abszolút útvonala a fent létrehozott fájlnak, pl.
<code>C:\Users\Pistike\mosquitto.conf</code>, mert az alábbi parancssorban teljes útvonalával kell majd beírjuk. És ennek az
útvonalnak az ismeretében adjuk ki az alábbi parancsot:</p>
<div class="highlight"><pre><span></span><code>docker run --name mosquitto -it -p 1883:1883 -p 9001:9001 -v &lt;ÚTVONAL&gt;\mosquitto.conf:/mosquitto/config/mo
squitto.conf eclipse-mosquitto
</code></pre></div>
<p>Ha másképp indítod, pl Docker Desktoppal vagy kézileg telepítve, ügyelj rá, hogy az emulátort futtató hosztgép
1883-as portján elérhető legyen, és hogy a konfigurációs fájl mappelése a konténerbe megtörténjen.</p>
<p>A fenti parancsra letöltődik, és elindul a <code>Mosquitto</code> jelenlegi aktuális verziója, és a háttérben fog futni.
Most adjuk ki az alábbi parancsot, ezzel a futó konténerben tudunk egy parancssort indítani:</p>
<div class="highlight"><pre><span></span><code>docker exec -it mosquitto /bin/sh
</code></pre></div>
<p>Látjuk, hogy egy <code>/ #</code> formátumú prompt jelzi, hogy a konténer gyökerében vagyunk. Itt, a belső parancssorban adjuk ki
a következő parancsot:</p>
<div class="highlight"><pre><span></span><code>mosquitto_sub -h localhost -t bookings
</code></pre></div>
<p>Ezzel feliratkoztunk a <code>bookings</code> nevű üzenetsorra, és itt a konzolon látni fogjuk, ha az alkalmazásunk sikeresen
beküld egy foglalást.</p>
<p>Most már elkezdhetünk dolgozni az alkalmazással. A projektvázban egy placeholder <code>BookingRepositoryImpl</code> osztály
van bekötve, ez csak loggolja a foglalásokat, és a Logcat nézetben megtekinthetőek. Ehelyett készítjük el az MQTT
alapú implementációt.</p>
<p>Kezdetben vegyük fel a szükséges új függőségeket a <code>build.gradle.kts</code> fájlunkba:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// MQTT</span>
<span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.github.hannesa2:paho.mqtt.android:4.3.beta4&quot;</span><span class="p">)</span>
<span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.legacy:legacy-support-v4:1.0.0&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Mivel a <code>Paho</code> könyvtár olyan verzióját használjuk, amely nincs fent a Google repository-jában, ezért a
<code>settings.gradle.kts</code> fájlban is frissítenünk kell a repository-listát:</p>
<div class="highlight"><pre><span></span><code><span class="n">dependencyResolutionManagement</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">repositoriesMode</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">RepositoriesMode</span><span class="p">.</span><span class="na">FAIL_ON_PROJECT_REPOS</span><span class="p">)</span>
<span class="w">    </span><span class="n">repositories</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">google</span><span class="p">()</span>
<span class="w">        </span><span class="n">mavenCentral</span><span class="p">()</span>
<span class="w">        </span><span class="n">maven</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">setUrl</span><span class="p">(</span><span class="s">&quot;https://jitpack.io&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Majd néhány szükséges engedélyt a <code>Manifest</code> fájlba. Ezek a használt könyvtárnak szükségesek:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.WAKE_LOCK&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<p>Most létrehozzuk az új repository-nkat <code>BookingRepositoryMqttImpl</code> néven:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.travel.data.datasource</span>

<span class="k">import</span><span class="w"> </span><span class="nn">android.content.Context</span>
<span class="k">import</span><span class="w"> </span><span class="nn">android.util.Log</span>
<span class="k">import</span><span class="w"> </span><span class="nn">info.mqtt.android.service.MqttAndroidClient</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.eclipse.paho.client.mqttv3.IMqttActionListener</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.eclipse.paho.client.mqttv3.IMqttDeliveryToken</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.eclipse.paho.client.mqttv3.IMqttToken</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.eclipse.paho.client.mqttv3.MqttCallback</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org.eclipse.paho.client.mqttv3.MqttMessage</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">BookingRepositoryMqttImpl</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BookingRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BOOKING&quot;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">URI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tcp://10.0.2.2:1883&quot;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">CLIENT_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TravelApp&quot;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TOPIC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bookings&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">sendBooking</span><span class="p">(</span>
<span class="w">        </span><span class="n">flightNumber</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">        </span><span class="n">seats</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">        </span><span class="n">contactEmail</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">mqttClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MqttAndroidClient</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">URI</span><span class="p">,</span><span class="w"> </span><span class="n">CLIENT_ID</span><span class="p">)</span>
<span class="w">        </span><span class="n">mqttClient</span><span class="p">.</span><span class="na">setCallback</span><span class="p">(</span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">MqttCallback</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">connectionLost</span><span class="p">(</span><span class="n">cause</span><span class="p">:</span><span class="w"> </span><span class="n">Throwable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error: </span><span class="si">${</span><span class="n">cause</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">messageArrived</span><span class="p">(</span>
<span class="w">                </span><span class="n">topic</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">                </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="n">MqttMessage?</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Message arrived: </span><span class="si">${</span><span class="n">message</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deliveryComplete</span><span class="p">(</span><span class="n">token</span><span class="p">:</span><span class="w"> </span><span class="n">IMqttDeliveryToken?)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Delivery successful&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="c1">// Only sending one message per connection</span>
<span class="w">                </span><span class="n">mqttClient</span><span class="p">.</span><span class="na">disconnect</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">})</span>

<span class="w">        </span><span class="n">mqttClient</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">IMqttActionListener</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onSuccess</span><span class="p">(</span><span class="n">asyncActionToken</span><span class="p">:</span><span class="w"> </span><span class="n">IMqttToken?)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Successful connection&quot;</span><span class="p">)</span>

<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">$</span><span class="n">flightNumber</span><span class="s">;</span><span class="si">$</span><span class="n">seats</span><span class="s">;</span><span class="si">$</span><span class="n">contactEmail</span><span class="s">&quot;</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MqttMessage</span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">(</span><span class="n">Charsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">))</span>
<span class="w">                </span><span class="n">mqttClient</span><span class="p">.</span><span class="na">publish</span><span class="p">(</span><span class="n">TOPIC</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onFailure</span><span class="p">(</span>
<span class="w">                </span><span class="n">asyncActionToken</span><span class="p">:</span><span class="w"> </span><span class="n">IMqttToken?,</span>
<span class="w">                </span><span class="n">exception</span><span class="p">:</span><span class="w"> </span><span class="n">Throwable?</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Connection failed: </span><span class="si">$</span><span class="n">exception</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A fenti kódban az alábbiakat figyelhetjük meg:</p>
<ul>
<li>A klienskönyvtár callbackek segítségével működik, és ezeket két részletben kell megadunk. Bizonyos eseményekre
már a kliens létrehozásakor feliratkozunk, de a kapcsolat sikeres vagy sikertelen felépítésére csak a kapcsolódáskor.</li>
<li>Jelenleg csak egy üzenetet küldünk be, majd bontjuk is a kapcsolatot. Viszont az üzenetküldés aszinkron, így nem
lehet egyből az <code>mqttClient.publish(TOPIC, message)</code> sor után bontani a kapcsolatot, mert akkor nem lesz ideje a
küldésnek lefutnia. Ezért a kapcsolatot a <code>deliveryComplete()</code> callbackben bontjuk, ettől viszont a kód kicsit
széttagolt lesz.</li>
<li>A kapcsolatot fent lehetne tartani, és fogadhatnánk is üzeneteket az üzenetsoron keresztül, akár különböző topic-okra
feliratkozva, és különböző topic-okba publikálva. De ezt a funkcionalitást ebben az alkalmazásban most nem használjuk ki.</li>
<li>Jelenleg a repository-t hívó viewmodel nem kap értesítést a művelet sikerességéről vagy sikertelenségéről, és a
repository meghívása után mindenképp hibaüzenet nélkül visszanavigál a főképernyőre, ezzel mindig azt sugallva, hogy a
művelet sikeres, akkor is ha valójában nem az.</li>
<li>Az üzenet tetszőleges tartalmú lehet, most CSV-ben küldjük szövegesen az adatot.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Modern App Architecture</p>
<p>Ahogyan az előző feladatrészben, most is valójában egy DataSource komponensbe kellene szerveznünk a logikát, ha
pontosan követni akarjuk a legújabb architekturális ajánlásokat.</p>
</div>
<p>Már csak az maradt hátra, hogy a korábbi dummy repository osztályt lecseréljük, ehhez a dependency injection beállításait
kell módosítanunk:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Module</span>
<span class="nd">@InstallIn</span><span class="p">(</span><span class="n">SingletonComponent</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">RepositoryModule</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Provides</span>
<span class="w">    </span><span class="nd">@Singleton</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideFlightRepository</span><span class="p">():</span><span class="w"> </span><span class="n">FlightRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlightRepositoryWebSocketImpl</span><span class="p">()</span>

<span class="w">    </span><span class="nd">@Provides</span>
<span class="w">    </span><span class="nd">@Singleton</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideBookingRepository</span><span class="p">(</span><span class="nd">@ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">):</span><span class="w"> </span><span class="n">BookingRepository</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">BookingRepositoryMqttImpl</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Most az alkalmazást kipróbálva a beküldésnek már működnie kell, ezt a Logcat nézetben, illetve a konzolban indított
parancssoros feliratkozással is tudjuk ellenőrizni.</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts képernyőképet (f2.png) a kapcsolódó kódrészletről, benne kommentként a Neptun-kódoddal, mellette a 
konzolos képernyő, ahol látszik a beküldött üzenet.</p>
</div>
<h3 id="harmadik-feladat-hibakezeles">Harmadik feladat: Hibakezelés<a class="headerlink" href="#harmadik-feladat-hibakezeles" title="Permanent link">&para;</a></h3>
<p>Ahogy az előző feladatrészben említettük, az elkészült megoldás nem teljes, mert a hibakezeléssel nem foglakoztunk.
A hibakezelés kérdése átgondolást igényel, mivel a repository rögtön visszatér, de a publikálás valójában
aszinkron módon történik. Gondold át ezt a problémakört! Milyen megoldást tudsz alkalmazni erre a problémára, amely
megfelel a modern architekturális ajánlásoknak is? Gondolkodj el rajta, mielőtt megnézed a segítséget!</p>
<details class="info">
<summary>Segítség</summary>
<p>A blokkoló hívások a performancia szempontjából nem jók, ezért az semmiképpen sem elfogadható, ha valamilyen módon
bevárjuk az eredményt, és a repository csak akkor tér vissza. A működésnek aszinkronnak kell maradnia.
A modern architekturális ajánlások szerint az aszinkron adatokat kétféleképpen érdemes kezelni. A folyamatosan frissülő
(eseményfolyam jellegű) adatokat Flow-k formájában javasolt kezelni, az egyszerieket egyszerű suspending függvényekként.
Mivel egy foglalás beküldésének kimenetele egyszeri eredmény, ezért az utóbbi a legalkalmasabb megoldás. A repository
látszólag akkor térjen vissza, amikor tényleg befejeződött a művelet, de suspending függvényként ne blokkolja az
alkalmazás UI szálát. Ha pedig hiba történik, dobhat kivételt. A kérdés már csak az, hogyan lehet ezt implementálni?
A függvény törzsének végén tudunk egy ciklusban várakozni egy flagre, amit az MQTT könyvtár callbackje állít be, és
ahol jelzi, ha sikeresen vagy sikertelenül lefutott a beküldés. Viszont a várakozás közben időről-időre el kell altatnunk
a szálat, hogy ne legyen blokkoló más komponensek számára. A Kotlin <code>delay()</code> függvénye lehet ebben a segítségünkre.</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">sendBooking</span><span class="p">(</span>
<span class="w">    </span><span class="n">flightNumber</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">seats</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="n">contactEmail</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Result</span><span class="p">(</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">done</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">ex</span><span class="p">:</span><span class="w"> </span><span class="n">Throwable? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Result</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="na">done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">delay</span><span class="p">(</span><span class="m">500</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">ex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">ex</span><span class="o">!!</span>
<span class="p">}</span>
</code></pre></div>
</details>
<p>Ha elkészültél az implementációval, teszteld a sikeres és a sikertelen esetet is! A sikertelen eset tesztelésére
ideiglenesen módosíthatod a kódot, hogy fixen hibát adjon a küldés.</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts képernyőképet (f3.png) a kapcsolódó kódrészletről, benne kommentként a Neptun-kódoddal, mellette a
futó alkalmazás a hibajelzéssel</p>
</div>
<h3 id="negyedik-feladat-orszaginfok-lekerdezese">Negyedik feladat: Országinfók lekérdezése<a class="headerlink" href="#negyedik-feladat-orszaginfok-lekerdezese" title="Permanent link">&para;</a></h3>
<p>Készíts egy új képernyőt, ahol egy GraphQL adatbázisban elérhető információk alapján megjeleníted az országokat az
alapvető jellemzőikkel!</p>
<p>Itt találsz a feladathoz egy publikusan elérhető GraphQL API-t:
<a href="https://github.com/trevorblades/countries">https://github.com/trevorblades/countries</a></p>
<p>Ezt az API-t ezen az online felületen ki is tudod próbálni:
<a href="https://countries.trevorblades.com/">https://countries.trevorblades.com/</a></p>
<p>Használhatod ezt a query-t a lekérdezéshez:</p>
<div class="highlight"><pre><span></span><code>query Countries {
  countries {
    name
    capital
    currency
    languages {
      name
    }
  } 
</code></pre></div>
<p>Most a GraphQL API használatán van a hangsúly, a képernyőnek nem szükséges bonyolultnak lennie, lehet egy egyszerű
<code>ListItem</code> alapú lista a járatok listájához hasonlóan. A menürendszer már elő van készítve a funkcióra, csak a megfelelő
helyen meg kell hívnod az új Screent composable függvényként.</p>
<p>Mintaként használd az előadás diáit és az előadáson bemutatott példaprogramot:
<a href="https://github.com/VIAUBXAV080/EA/tree/main/06">https://github.com/VIAUBXAV080/EA/tree/main/06</a></p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts képernyőképet (f4.png) az országok listájáról, ahol látszódnak a megjelenített jellemzők is.</p>
</div>
<h3 id="otodik-feladat-authentikacio">Ötödik feladat: Authentikáció<a class="headerlink" href="#otodik-feladat-authentikacio" title="Permanent link">&para;</a></h3>
<p>Az alkalmazás login képernyője ezidáig bármit elfogadott, viszont a backend implementálja a bejelentkezést. Alakítsd át
úgy az alkalmazást, hogy ténylegesen a backend hívásával végezze a bejelentkezést.</p>
<p>Nem feladat az alkalmazásban a regisztráció megvalósítása, de a bejelentkezéshez először egy felhasználót kell
létrehoznod. A backendben ehhez is készült egy végpont, ezt meghívhatod a már megismert Swagger UI-jal vagy a
Postmannel is. Nézd meg a hívás pontos módját a generált API-leírásban!</p>
<p>Ha regisztráltál felhasználót, akkor már használhatod a bejelentkezéshez is. A bejelentkezéshez is egy REST végpontot
kell hívnod. Ez a sikeres bejelentkezést 200 OK státuszkóddal és egy törzsben visszaadott tokennel jelzi. Ha sikertelen
a bejelentkezés, akkor 401 UNAUTHORIZED választ kapsz.</p>
<p>Módosítsd úgy az alkalmazást, hogy a login képernyő ezt a végpontot használja, és csak akkor továbbítson a főképernyőre,
ha sikeres volt a bejelentkezés. A backend hívását "kézzel" is elvégezheted, de akár használhatod a korábban megismert
OpenAPI alapú kódgenerálást is!</p>
<p>Ebben a feladatrészben a visszaadott tokent még bárhogyan tárolhatod (pl. Application osztály companion objectjében),
a biztonságossá tétele majd a következő feladatrészben valósul meg.</p>
<p>A backendben a <code>/api/users/me</code> endpoint hívható úgy, hogy a tokent az <code>Authorization</code> headerben küldöd, és ez visszaadja
a tokenhez tartozó felhasználó nevét. Jeleníts meg ez alapján egy személyre szabott üdvözlést a főképernyő tetején.</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts képernyőképet (f5.png) a kapcsolódó kódrészletről, benne kommentként a Neptun-kódoddal,
mellette a backend logja a sikeres bejelentkezésről és a telefon főképernyője az üdvözlő szöveggel.</p>
</div>
<h3 id="hatodik-feladat-token-biztonsagos-tarolasa">Hatodik feladat: Token biztonságos tárolása<a class="headerlink" href="#hatodik-feladat-token-biztonsagos-tarolasa" title="Permanent link">&para;</a></h3>
<p>Egy egyszerre kényelmesen és biztonságosan működő alkalmazás a backendtől kapott hozzáférési tokent titkosítva tárolná
el, és az újbóli megnyitások alkalmával - amikor már van letárolt token - a felhasználót biometrikusan vagy
képernyőmintával, esetleg PIN-kóddal azonosítaná. Ebben a feladatrészben ezt kell megvalósítani.</p>
<p>Az alábbi cikkben részletesen ismertetik a szükséges lépéseket:
<a href="https://medium.com/@ostorlab/introduction-d481bcc774c8">https://medium.com/@ostorlab/introduction-d481bcc774c8</a></p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts képernyőképet (f6.png) a kapcsolódó kódrészletről, benne kommentként a Neptun-kódoddal, mellette a
futó alkalmazás az ujjlenyomat-azonosítást kérő dialógussal.</p>
</div>

    <hr>
  <div class="md-source-file">
    <span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg
          xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
          </path>
        </svg>
      </span>
      <span title="2024. október 26. 15:09:07">
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-10-26T15:09:07+02:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-10-26</span>
      </span>
    </span>

    

    <span class="md-source-file__fact">
      <span class="md-icon" title="Szerzők">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
          </path>
        </svg>
      </span>
      <span>Szerzők</span>
      <nav></nav>      
    </span>
  </div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Vissza a tetejére
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; BME VIK AUT
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>